series: {{ series }}
applications:
  ubuntu-release-metrics-collector:
    charm: ./{{ series }}/ubuntu-release-metrics-collector
    num_units: 1
    options:
      influxdb-hostname: include-file://{{ local_dir }}/influx-hostname.txt
      influxdb-username: metrics
      influxdb-password: include-file://{{ local_dir }}/influx-password.txt
      influxdb-database: metrics
      http-proxy: http://squid.internal:3128
      https-proxy: http://squid.internal:3128
      no-proxy: 127.0.0.1,::1,localhost,10.0.0.0/8,canonical.com,ubuntu.com,launchpad.net,internal
{%- if stage_name == "production" or stage_name == "staging" %}
  telegraf:
    charm: telegraf
    expose: True
  landscape-client:
    charm: landscape-client
    options:
      account-name: standalone
      ping-url: http://landscape.is.canonical.com/ping
      tags: juju-managed
      url: https://landscape.is.canonical.com/message-system
      registration-key: include-file://{{local_dir}}/landscape-registration-key
  ua:
    charm: cs:~ubuntu-advantage-charmers/ubuntu-advantage
    options:
      token: include-file://{{local_dir}}/canonical-is-ua.key
relations:
  - ["ubuntu-release-metrics-collector:juju-info", "telegraf"]
  - ["ua", "ubuntu-release-metrics-collector"]
  - ["landscape-client", "ubuntu-release-metrics-collector"]
{%- endif %}
